"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,r,a){return{createCube:function(e,a){var s=a.layout,t=r.validateDimension(s.props.dimensions[0]),p=[{qNullSuppression:!0,qDef:{qFieldDefs:[t],qSortCriterias:[{qSortByExpression:s.props.dimSort||!s.props.dimSortByExpression?0:s.props.dimSortByExpressionAsc,qSortByNumeric:s.props.dimSort?1:s.props.dimSortByNum?s.props.dimSortByNumAsc:0,qSortByAscii:s.props.dimSort||!s.props.dimSortByAlph?0:s.props.dimSortByAlphAsc,qExpression:{qv:s.props.dimSortByExpressionString}}]}}],l=s.props.measures.length;a.rowsLabel=["(Intercept)",r.validateMeasure(s.props.measures[1])];for(var i=r.validateMeasure(s.props.measures[0])+" as mea0, "+r.validateMeasure(s.props.measures[1])+" as mea1",o="q$mea0 ~ q$mea1",n=2;n<l;n++){var m=r.validateMeasure(s.props.measures[n]);if(m.length>0){var u=","+m+" as mea"+n;i+=u,o+=" + q$mea"+n,a.rowsLabel.push(r.validateMeasure(s.props.measures[n]))}}var q=.3,d="library(caret);target <- q$mea0; preParams <- preProcess(q[,1:"+l+'], method=c("range"));q <- predict(preParams, q[,1:'+l+"]); q$mea0 <- target",c='m = abs(cor(subset(q,q$mea0 != 0),q$mea0[q$mea0 != 0], method = "pearson"))',v='f="";for(j in 2:'+l+") if(!is.na(m[j]) && m[j]>="+q+'){l=paste("q$mea",j-1,sep=""); f=paste(f,l,sep=" + ")} ;f=paste("q$mea0 ~ ",substring(f,3));str(f)',f="q$mea0 > 0",h="q = subset(q,q$mea0 == 0); q$mea0[q$mea0 == 0] <- NA;";r.displayDebugModeMessage(s.props.debugMode);var y=r.getDebugSaveDatasetScript(s.props.debugMode,"debug_regression_analysis_line_chart.rda"),b="R.ScriptEval('"+y+" "+d+"; if(sum(q$mea0)> 0 && min(q$mea0) == 0){"+c+"; "+v+"; lm_result <- lm(as.formula(f), q, "+f+");"+h+' predict(lm_result, q, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+");} else{lm_result <- lm("+o+');predict(lm_result, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+"); }[,1]',"+i+")",g="R.ScriptEval('"+d+"; if(sum(q$mea0)> 0 && min(q$mea0) == 0){"+c+"; "+v+"; lm_result <- lm(as.formula(f), q, "+f+");"+h+' predict(lm_result, q, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+");} else{lm_result <- lm("+o+');predict(lm_result, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+"); }[,2]',"+i+")",N="R.ScriptEval('"+d+"; if(sum(q$mea0)> 0 && min(q$mea0) == 0){"+c+"; "+v+"; lm_result <- lm(as.formula(f), q, "+f+");"+h+' predict(lm_result, q, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+");} else{lm_result <- lm("+o+');predict(lm_result, interval="'+s.props.interval+'", level='+s.props.confidenceLevel+"); }[,3]',"+i+")";r.displayRScriptsToConsole(s.props.debugMode,[b,g,N]);var S=r.validateMeasure(s.props.measures[0]),$=[{qDef:{qDef:S}},{qDef:{qDef:b}},{qDef:{qDef:g}},{qDef:{qDef:N}},{qDef:{qLabel:"-",qDef:""}}];return a.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(p)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify($)}],!1),a.patchApplied=!0,null},drawChart:function(s,t){var p=a.defer(),l=s.layout,i=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return s.backendApi.getData(i).then(function(a){var i=s.layout.qHyperCube.qMeasureInfo;if(isNaN(i[1].qMin)&&isNaN(i[1].qMax)&&isNaN(i[2].qMin)&&isNaN(i[2].qMax)&&isNaN(i[3].qMin)&&isNaN(i[3].qMax))r.displayConnectionError(s.extId);else{r.displayReturnedDatasetToConsole(l.props.debugMode,a[0]);var o=r.getDefaultPaletteColor(),n=[],m=[],u=[],q=[],d=[],c=[];$.each(a[0].qMatrix,function(e,r){n.push(r[0].qElemNumber),0==r[1].qNum&&m.push(r[0].qText),u.push(r[1].qNum),q.push(r[2].qNum),d.push(r[3].qNum),c.push(r[4].qNum)});var v=[{x:m,y:q,name:"Fit",mode:"none",type:"bar",line:{color:"rgba("+o[l.props.colorForSub]+",1)"}}];$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>');var f=e.draw(s,v,"aat-chart-"+s.extId,null);e.setEvents(f,s,t)}return p.resolve()}),p.promise}}});
//# sourceMappingURL=../../maps/analysis/regression_predict.js.map
